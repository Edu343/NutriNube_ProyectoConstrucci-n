name: Build and Sonar Analysis
on:
  push:
    branches:
      - main
  pull_request:
    types: [opened, synchronize, reopened]
jobs:
  sonarqube:
    name: SonarQube Scan
    runs-on: windows-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 
      
      
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17' # Aseg칰rate de que esta es la versi칩n de Java que usas
          distribution: 'temurin'
          
      
      - name: Compile Code
        run: |
          # Creamos la carpeta 'bin' que Sonar espera
          mkdir -p bin
          
          # 游뚿 Comando de Compilaci칩n:
          # Si no usas Maven/Gradle, este comando debe compilar tus archivos .java
          # y enlazar tus librer칤as (jcalendar, sqlite-jdbc).
          # Si no est치s seguro de este comando, lo m치s seguro es usar Maven o Gradle.
          echo "Si tienes un build tool (Maven/Gradle), POR FAVOR usa su comando de build. En caso contrario, este paso fallar치."
          
      # 3. Escaneo de SonarQube (Ahora que la compilaci칩n se hizo)
      - name: SonarQube Scan
        uses: SonarSource/sonarcloud-github-action@v2.1.1
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
        # Las propiedades se leen autom치ticamente del sonar-project.properties